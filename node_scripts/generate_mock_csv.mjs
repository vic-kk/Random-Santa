import { writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ ES –º–æ–¥—É–ª—è—Ö
const __filename = fileURLToPath(import.meta.url);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–π –¥–∞—Ç—ã –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
function generateRandomDate() {
  const start = new Date(2025, 11, 1); // 1 –¥–µ–∫–∞–±—Ä—è 2025
  const end = new Date(2025, 11, 31); // 31 –¥–µ–∫–∞–±—Ä—è 2025
  const date = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  const options = {
    timeZone: 'Asia/Bangkok', // GMT+7
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  };
  
  const dateStr = date.toLocaleString('en-US', options);
  return `${dateStr.replace(',', '')} GMT+7`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ (6 —Ü–∏—Ñ—Ä)
function generateRandomNumber() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≥–µ–Ω–¥–µ—Ä–∞
function generateRandomGender() {
  const genders = ['–î–∏–≤—á–∏–Ω–∞', '–ú–£–ñ–ò–ö'];
  return genders[Math.floor(Math.random() * genders.length)];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–∂–µ–ª–∞–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
function generateRandomWish() {
  const wishes = [
    // 40% - –ø—É—Å—Ç—ã–µ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ
    '', '', '', '', '', '',
    '–ù–µ—Ç –ø–æ–∂–µ–ª–∞–Ω–∏–π',
    '–ö–∞–∫ –µ—Å—Ç—å',
    '–õ—é–±–æ–π –ø–æ–¥–∞—Ä–æ–∫',
    '–ù–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ',

    // 30% - –æ–±—ã—á–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
    '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –±–µ–∑ —Å–ª–∞–¥–∫–æ–≥–æ üö´üç¨',
    '–õ—é–±–ª—é —Å–ª–∞–¥–∫–æ–µ! üç´',
    '–ß—Ç–æ-–Ω–∏–±—É–¥—å –ø–æ–ª–µ–∑–Ω–æ–µ ü•¶',
    '–ß–∞–π –∏–ª–∏ –∫–æ—Ñ–µ ‚òï',
    '–ö–Ω–∏–≥—É üìö',
    '–î–ª—è –¥–æ–º–∞ üè†',
    '–°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —É—Ö–æ–¥–∞ üß¥',

    // 20% - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
    '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –±–µ–∑ —Å–ª–∞–¥–∫–æ–≥–æ –∏ —Å–æ–ª–µ–Ω–æ–≥–æ. –ü—Ä–µ–¥–ø–æ—á—Ç—É —á—Ç–æ-—Ç–æ –ø–æ–ª–µ–∑–Ω–æ–µ –∏–ª–∏ –¥–ª—è –¥–æ–º–∞ üåø',
    '–û–±–æ–∂–∞—é —Å–ª–∞–¥–æ—Å—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ —à–æ–∫–æ–ª–∞–¥ –∏ –ø–µ—á–µ–Ω—å–µ! –ß–µ–º —Å–ª–∞—â–µ, —Ç–µ–º –ª—É—á—à–µ üç™üòã',
    '–•–æ—Ç–µ–ª–æ—Å—å –±—ã –∫–Ω–∏–≥—É –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞. –†—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è üé®',
    '–ß—Ç–æ-–Ω–∏–±—É–¥—å –¥–ª—è —É—é—Ç–∞ –≤ –¥–æ–º–µ: —Å–≤–µ—á–∏, –¥–µ–∫–æ—Ä –∏–ª–∏ –∫–æ–º–Ω–∞—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ üïØÔ∏èüå±',
    '–¢–æ–ª—å–∫–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞ –∏–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —É—Ö–æ–¥–∞ –∑–∞ –∫–æ–∂–µ–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ üå∏',

    // 10% - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ/—Å —ç–º–æ–¥–∑–∏
    '–°—é—Ä–ø—Ä–∏–∑! –ì–ª–∞–≤–Ω–æ–µ - –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –∑–∞–±–æ—Ç–∞ ü•∞üíñ',
    '–î–µ–ª–∞–π—Ç–µ –∫–∞–∫ –∑–Ω–∞–µ—Ç–µ, –¥–æ–≤–µ—Ä—è—é –≤–∞—à–µ–º—É –≤–∫—É—Å—É! ‚ú®üéÅ',
    '–ß—Ç–æ —É–≥–æ–¥–Ω–æ, –ª–∏—à—å –±—ã –Ω–µ –Ω–æ—Å–∫–∏! üòÑüß¶‚ùå',
    '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç —Å–µ—Ä–¥—Ü–∞ - –ª—É—á—à–∏–π –ø–æ–¥–∞—Ä–æ–∫ ‚ù§Ô∏èü§ó',
    '–≠–∫–æ–ª–æ–≥–∏—á–Ω—ã–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂—É üåçüõí'
  ];
  return wishes[Math.floor(Math.random() * wishes.length)];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
function generateRandomAddress(city = null) {
  const cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–ß–µ–ª—è–±–∏–Ω—Å–∫', '–°–∞–º–∞—Ä–∞', '–û–º—Å–∫', '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É'];
  const streets = ['–õ–µ–Ω–∏–Ω–∞', '–ü—É—à–∫–∏–Ω–∞', '–ì–∞–≥–∞—Ä–∏–Ω–∞', '–°–æ–≤–µ—Ç—Å–∫–∞—è', '–ú–∏—Ä–∞', '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è', '–ú–æ–ª–æ–¥–µ–∂–Ω–∞—è', '–®–∫–æ–ª—å–Ω–∞—è', '–°–∞–¥–æ–≤–∞—è', '–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è'];
  
  const selectedCity = city || cities[Math.floor(Math.random() * cities.length)];
  const street = streets[Math.floor(Math.random() * streets.length)];
  const building = Math.floor(Math.random() * 200) + 1;
  const corpus = Math.random() > 0.7 ? ` –∫–æ—Ä–ø—É—Å ${Math.floor(Math.random() * 5) + 1}` : '';
  
  return `${selectedCity}, —É–ª–∏—Ü–∞ ${street} ${building}${corpus}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
function generateDataRow(index) {
  const timestamp = generateRandomDate();
  const uniqueNumber = generateRandomNumber();
  const gender = generateRandomGender();
  const wish = generateRandomWish();
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥–æ—Ä–æ–¥ –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–æ–≤
  const city = Math.random() > 0.5 ? null : '–ú–æ—Å–∫–≤–∞';
  const ozonAddress = generateRandomAddress(city);
  
  // –î–ª—è WB –∞–¥—Ä–µ—Å –∏–Ω–æ–≥–¥–∞ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
  let wbAddress;
  if (Math.random() > 0.8) {
    // 20% —Å–ª—É—á–∞–µ–≤ –∞–¥—Ä–µ—Å–∞ —Ä–∞–∑–Ω—ã–µ
    const newCity = city || (Math.random() > 0.5 ? '–ú–æ—Å–∫–≤–∞' : '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥');
    wbAddress = generateRandomAddress(newCity);
  } else {
    // 80% —Å–ª—É—á–∞–µ–≤ –∞–¥—Ä–µ—Å–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–ª–∏ –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
    if (Math.random() > 0.5) {
      wbAddress = ozonAddress;
    } else {
      // –ù–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω—è–µ–º –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—Ä—É–≥–æ–π –∫–æ—Ä–ø—É—Å)
      wbAddress = ozonAddress.replace(/–∫–æ—Ä–ø—É—Å \d+/, `–∫–æ—Ä–ø—É—Å ${Math.floor(Math.random() * 5) + 2}`) || ozonAddress;
    }
  }
  
  return [
    `"${timestamp}"`,
    `"${uniqueNumber}"`,
    `"${gender}"`,
    `"${wish}"`,
    `"${ozonAddress}"`,
    `"${wbAddress}"`
  ].join(',');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CSV —Ñ–∞–π–ª–∞
export function createCSVFile(filename, rowCount = 100) {
  // –ó–∞–≥–æ–ª–æ–≤–∫–∏
  const headers = [
    '"–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"',
    '"–£–∫–∞–∂–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–π –Ω–∞ —Å–∞–π—Ç–µ"',
    '"–£–∫–∞–∂–∏ —Å–≤–æ–π –≥–µ–Ω–¥–µ—Ä"',
    '"–£–∫–∞–∂–∏ —Å–≤–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å. –ß—Ç–æ —Ö–æ—Ç–µ–ª–æ—Å—å/–Ω–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –ø–æ–ª—É—á–∏—Ç—å."',
    '"–û–ó–û–ù –ê–¥—Ä–µ—Å"',
    '"–í–ë –ê–¥—Ä–µ—Å"'
  ].join(',');
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  const rows = [headers];
  for (let i = 0; i < rowCount; i++) {
    rows.push(generateDataRow(i));
  }
  
  // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
  const csvContent = rows.join('\n');
  
  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª
  writeFileSync(filename, csvContent, 'utf8');
  console.log(`–§–∞–π–ª ${filename} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —Å ${rowCount} —Å—Ç—Ä–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.`);
  
  // –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  console.log('\n–ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ —Ñ–∞–π–ª–∞:');
  console.log(rows.slice(0, 4).join('\n'));
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  const args = process.argv.slice(2);
  let rowCount = 15; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 15 —Å—Ç—Ä–æ–∫
  
  // –ü–∞—Ä—Å–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
  if (args.length > 0) {
    const count = parseInt(args[0]);
    if (!isNaN(count) && count > 0) {
      rowCount = count;
    }
  }
  
  const filename = `_local/SANTA.csv`;
  
  try {
    createCSVFile(filename, rowCount);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error.message);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –æ–Ω –≤—ã–∑–≤–∞–Ω –Ω–∞–ø—Ä—è–º—É—é
if (process.argv[1] === fileURLToPath(import.meta.url)) {
  main();
}